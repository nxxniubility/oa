<!DOCTYPE html>
<html>
<head>
    <meta http-equiv=”X-UA-Compatible” content=”IE=edge,chrome=1″/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>系统首页-{$siteinfo.sitename}</title>
    <link rel="stylesheet" href="__PUBLIC__/css/common.css">
    <link rel="stylesheet" href="__PUBLIC__/css/external.min.css">
    <link rel="stylesheet" href="__PUBLIC__/css/templateList.css">
</head>
<body>
<div class="wrapBox">
    <div class="proCont">
        <div class="proContTop clearfix">
            <div class="topTit l">
                <span class="masterList">专题页列表</span>
                <span><em>&gt;</em>添加模板 </span>
            </div>
            <div class="topRight r">
                <a href="{$data['url_pages']}" class="return">返回</a>
            </div>
        </div>
        <div class="addContMiddle">
            <div class="addMiddle2">
                <span class="tlStep1"></span>
                <span class="tlStep22"></span>
            </div>

            <!-- 选择导航区域 S -->
            <div class="selectNavigation">
                <!-- 三个按钮 S -->
                <div class="snCont">
                    <div class="snRow clearfix">
                        <span>导航：</span>
                        <input type="button" class="toggleBtn" value="选择导航">
                    </div>
                    <div class="snRow dn">
                        <span>&nbsp;</span>
                        <input type="submit" class="snSubmit" value="提交">
                    </div>
                    <div class="snRow clearfix">
                        <span>&nbsp;</span>
                        <a href="{:U('System/Promote/pages')}" class="snPrevious">返回专题页列表</a>
                    </div>
                </div>
                <!-- 三个按钮 E -->

                <!-- 选择导航主内容 S -->
                <div class="snMain">
                    <div class="snSmallList" id="onBoxCon">
                        <input type="button" class="snOptout" value="放弃选择">
                        <!-- 有导航 -->
                        <div class="smallListBox">
                            <ul class="clearfix smallListBoxCon">
                                <if condition="!empty($data['detail'])">
                                    <foreach name="data['detail']" item="v" key="k">
                                    <li class="smallListBoxLi{$v.pages_nav_id}">
                                        <a href="javascript:;">
                                            <div onclick="removeMy(this)" class="boxClose"></div>
                                            <div class="boxId">{$v.pages_nav_id}</div>
                                            <div class="picBox">
                                                <img src="{$v.litpic}">
                                            </div>
                                            <div class="btomBox">
                                                <input type="text" placeholder="请填写导航名称" class="btomInp" value="{$v.nav_name}">
                                            </div>
                                        </a>
                                    </li>
                                    </foreach>
                                <else/>
                                    <span class="snNothing">请选择导航</span>
                                </if>
                            </ul>
                        </div>
                    </div>
                    <div class="snBigList">
                        <div class="snSearchBox">
                            <h4>单击选择需要的导航</h4>
                            <div class="snSearchMain">
                                <div class="selectbox snBigOne l">
                                    <dl class="select">
                                        <dt>
                                            <div class="select_title l">选择所属终端:</div>
                                            <div class="arrow r"></div>
                                        </dt>
                                        <dd class="fxDone" onclick="setquest(0,1)">全部</dd>
                                        <foreach name="data['terminalAll']" item="v" key="k" >
                                            <dd class="fxDone" onclick="setquest('{$v.terminal_id}',1)" data-value="{$v.terminal_id}">{$v.terminalname}</dd>
                                        </foreach>
                                    </dl>
                                </div>
                                <div class="selectbox snBigTwo l">
                                    <dl class="select">
                                        <dt>
                                            <div class="select_title l">选择所属服务:</div>
                                            <div class="arrow r"></div>
                                        </dt>
                                        <dd class="fxDone" onclick="setquest(0,2)">全部</dd>
                                        <foreach name="data['pagesType']" item="v" key="k" >
                                            <dd class="fxDone" onclick="setquest('{$v.pagestype_id}',2)" data-value="{$v.pagestype_id}">{$v.typename}</dd>
                                        </foreach>
                                    </dl>
                                </div>
                                <div class="selectbox snBigThr l">
                                    <dl class="select">
                                        <dt>
                                            <div class="select_title l">选择所属课程:</div>
                                            <div class="arrow r"></div>
                                        </dt>
                                        <dd class="fxDone" onclick="setquest(0,3)">全部</dd>
                                        <foreach name="data['courseAll']" item="v" key="k" >
                                            <dd class="fxDone" onclick="setquest('{$v.course_id}',3)" data-value="{$v.course_id}">{$v.coursename}</dd>
                                        </foreach>
                                    </dl>
                                </div>
                                <div class="selectbox snBigFou l">
                                    <dl class="select">
                                        <dt>
                                        <div class="select_title l">选择搜索类型:</div>
                                        <div class="arrow r"></div>
                                        </dt>
                                        <dd class="fxDone" onclick="key_name='pages_id';">模板ID</dd>
                                        <dd class="fxDone" onclick="key_name='subject';">主题</dd>
                                    </dl>
                                </div>
                                <input type="text" class="snSearchInp" name="key_val">
                                <input type="button" class="snSearchBtn" value="搜索">
                            </div>
                        </div>
                        <ul class="clearfix templateUl">

                        </ul>

                        <div class="snBigBoxBtom clearfix">
                            <div class="bigBoxBtomLeft">
                                <input type="submit" class="snSubmit l" id="nav_submit" value="提交">
                                <a href="{:U('System/Promote/pages')}" class="snPrevious ml30">返回专题页列表</a>
                            </div>
                            <div class="bigBoxBtomRight" id="paging_body">

                            </div>
                        </div>
                    </div>
                </div>
                <!-- 选择导航主内容 E -->

            </div>
            <!-- 选择导航区域 E -->

        </div>
    </div>
</div>

<script src="__PUBLIC__/js/jquery-1.8.3.min.js"></script>
<script src="__PUBLIC__/js/jquery.lib.min.js"></script>
<script src="__PUBLIC__/js/templateList.js"></script>
<script src="__PUBLIC__/js/layer/layer.js"></script>
<script src="__PUBLIC__/js/common_ajax.js"></script>
<script>

    var terminal_id = '';
    var pagestype_id = '';
    var course_id = '';
    var key_name='';
    $(function(){
        <if condition="!empty($data['detail'])">
            $('.toggleBtn').trigger('click'); pagesList(1);
        </if>
        $('.toggleBtn,.snSearchBtn').click(function(){
            pagesList(1);
        });

        $('#nav_submit').click(function(){
            var navs = '';
			if($('.smallListBoxCon li').length>0)
			{				
				$('.smallListBoxCon li').each(function(i){
					var _thisObj = $(this);
					if( _thisObj.find('input').val().length!=0 && _thisObj.find('input').val().length!=''){
						if(i==0){
							navs += _thisObj.find('.boxId').text()+'@@'+_thisObj.find('input').val();
						}else{
							navs += ','+_thisObj.find('.boxId').text()+'@@'+_thisObj.find('input').val();
						}
					}else{
						location.hash="#onBoxCon";
						layer.msg('请输入导航名称', {icon:2});                   
						navs='';
					};
				});
				if(navs!=''){
					var data = {
						navs:navs
					};
					common_ajax(data);
				};
			}else{
			   var data = {
						navs:''
			   };
			   common_ajax(data);
			}
        });
    });
    function setquest(id,type){
        if(type==1){
            terminal_id = id;
        }else if(type==2){
            pagestype_id = id;
        }else{
            course_id = id;
        }
        pagesList(1);
    }
    function pagesList(page){
        layer.load(2);
        $.ajax({
            url:"<?php echo U('System/Promote/pagesList'); ?>",
            dataType:'json',
            type:'post',
            data:{type:'getlist',page:page,terminal_id:terminal_id,pagestype_id:pagestype_id,course_id:course_id,key_name:key_name,key_val:$(':input[name="key_val"]').val()},
            success:function(reflag){
                layer.closeAll('loading');
                if(reflag.code==0){
                    if(reflag.data.paging){
                        var str = '';
                        $.each(reflag.data.data,function(k,v){
                            str+='<li> <a href="javascript:;"><div class="picBox data-value="'+v.pages_id+'"> <img src="'+v.litpic+'"> </div> <div class="snId">'+v.pages_id+'</div> <div class="snLiteral">'+v.subject+'</div> </a></li>';
                        });
                        $('.templateUl').empty().append(str);
                        $('#paging_body').empty().append(reflag.data.paging);
                    }else{
                        $('.templateUl,#paging_body').empty();
                    }
                }else{
                    layer.msg(reflag.msg,{icon:2});
                }
            },
            error:function(){
                layer.msg('网络异常,请稍后再试！',{icon:2});
                layer.closeAll('loading');
            }
        });
    };
</script>
</body>
</html>
