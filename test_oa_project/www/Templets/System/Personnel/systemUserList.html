<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
		<title>系统首页-{$siteinfo.sitename}</title>
		<link rel="stylesheet" href="__PUBLIC__/css/common.css">
		<link rel="stylesheet" href="__PUBLIC__/css/employeesList.css">
		<link rel="stylesheet" href="__PUBLIC__/js/layui/css/layui.css">
		<script src="__PUBLIC__/js/jquery-1.9.1.min.js"></script>
	</head>
	<body>
		<div class="wrapBox" id="sUserWrap">
			<div class="feCont">
				<div class="feContTop clearfix">
					<div class="topTit l">
						<span class="masterList">员工列表</span>
					</div>
					<div class="topRight r">
						<a href="{:U('System/Personnel/addSystemUser')}" class="newEmployees">新增员工</a>
						<a href="javascript:;" class="return Offline" data-id="">强制员工离线</a>
					</div>
				</div>
				<div class="feMiddle">
					<div class="feMiddleTop">
						<form id="foem1" action="{:U('System/Personnel/systemUserList')}" method="get" target="main" onsubmit="return false;">
							<div class="selectbox2 area l" id="role_li">
								<dl class="select">
									<dt>
									<div class="select_title l">全部职位</div>
									<div class="arrow r"></div>
									</dt>
								</dl>
							</div>
							<?php if(!empty($data['zoneAll']['level']) && $data['zoneAll']['level']<4 ){ ?>
							<div class="selectbox2 area l">
								<dl class="select2">
									<dt>
										<div class="select_title l">选择大区及城市</div>
										<div class="arrow r"></div>
									</dt>
									<?php if(!empty($data['zoneAll']['level']) && $data['zoneAll']['level']==1){ ?>
									<dt class="caption2">
										<div class="select_title3 l dt_btn" data-name='zone_id' onclick="getArea();" data-value="{$data['zoneAll']['zone_id']}">总部</div>
									</dt>
									<?php } ?>
									<?php if(!empty($data['zoneAll']['level']) && $data['zoneAll']['level']<4 ){ ?>
										<foreach name="data['zoneAll']['children']" item="v" key="k">
											<?php if( $v['level'] == 2 ){ ?>
												<?php if( !empty($v['children']) ){ ?>
													<dt class="caption">
														<div class="select_title2 l dt_btn" onclick="getArea();" data-name='zone_id' data-value="{$v.zone_id}">{$v.name}</div>
													</dt>
													<?php if( !empty($v['children']) ){ ?>
														<foreach name="v['children']" item="v2" key="k2">
															<dd class="fxDone" onclick="getArea('{$v2.zone_id}');" data-name='zone_id' data-value="{$v2.zone_id}">{$v2.name}</dd>
														</foreach>
													<?php } ?>
												<?php } ?>
											<?php }else{ ?>
												<dd class="fxDone" onclick="getArea('{$v.zone_id}');" data-name='zone_id' data-value="{$v.zone_id}">{$v.name}</dd>
											<?php } ?>
										</foreach>
									<?php } ?>
								</dl>
							</div>
							<?php } ?>
							<div class="selectbox chooseCenter l" id="areaBody" style="display: none"></div>
							<input type="hidden" name="zone_id" value="<?php echo !empty($data['requery']['zone_id'])?$data['requery']['zone_id']:0; ?>">
							<div class="selectbox employeeStatus l" id="usertype_li">
								<dl class="select">
									<dt>
									<div class="select_title l">全部员工状态</div>
									<div class="arrow r"></div>
									</dt>
								</dl>
							</div>
							<div class="feSearchBox l">
								<div class="selectbox searchInp l">
									<dl class="select">
										<dt>
											<div class="select_title l"><?php echo $data['requery']['key_name']=='realname'?'真实姓名':($data['requery']['key_name']=='email'?'电子邮箱':($data['requery']['key_name']=='system_user_id'?'用户ID':'请选择搜索类型')) ?></div>
											<div class="arrow r"></div>
										</dt>
										<dd class="fxDone" data-value="realname">真实姓名</dd>
										<dd class="fxDone" data-value="username">手机号码</dd>
										<dd class="fxDone" data-value="email">公司邮箱</dd>
										<dd class="fxDone" data-value="system_user_id">用户ID</dd>
									</dl>
									<input type="hidden" name="key_name" value="<?php echo !empty($data['requery']['key_name'])?$data['requery']['key_name']:''; ?>">
								</div>
								<input type="text" class="feInp" name="key_value" value="<?php echo !empty($data['requery']['key_value'])?$data['requery']['key_value']:''; ?>">
								<input type="submit" class="feSearchSubmit" value="搜索">
							</div>
						</form>
					</div>
					<div class="feMiddleTop" id="pjax_body">
						

					</div>
					<dl class="feOptions clearfix">
						<div class="leftChoose">
							<label for="feCheckBox1">
								<input type="checkbox" id="feCheckBox1" value="1" autocomplete="off">
								<span>全选</span>
							</label>
							<input type="button" value="删除所选" class="delInp">
						</div>
						<div class="collegaPage paging" id="paging">

						</div>
					</dl>
				</div>
			</div>
		</div>

		<!--列表模版-->
		<script id="demo" type="text/html">
			<table cellpadding="0" cellspacing="0" id="sUserListTable">
				<tr>
					<th class="firItem">选中</th>
					<th>
						<span>ID</span>
					</th>
					<th>头像</th>
					<th>真实姓名</th>
					<th>所属区域</th>
					<th>所属部门及职位</th>
					<th>性别</th>
					<th>员工状态</th>
					<th>注册时间</th>
					<th>登录时间</th>
					<th>操作</th>
				</tr>
				{{# layui.each(d, function(k, v){ }}
				<tr>
					<td class="firItem">
						<input type="checkbox" name="feCheck" class="feCheckBox" value="{{ v.system_user_id }}" autocomplete="off">
					</td>
					{{# if(v.isuserinfo==0){ }}
					<td style="color:red !important;">{{ v.system_user_id }}</td>
					{{# }else{ }}
					<td>{{ v.system_user_id }}</td>
					{{# } }}
					{{# if(v.face){ }}
					<td class="sPic"><img src="{{ v.face }}?x-oss-process=image/resize,m_lfit,w_30"></td>
					{{# }else if(v.sex==1){ }}
					<td class="sPic"><img src="__PUBLIC__/images/personalInfo_01-02.jpg"></td>
					{{# }else{ }}
					<td class="sPic"><img src="__PUBLIC__/images/personalInfo_01-01.jpg"></td>
					{{# } }}
					{{# if(v.isuserinfo==0){ }}
					<td style="color:red !important;">{{ v.realname }}</td>
					<td style="color:red !important;">{{ v.zonename }}</td>
					<td style="color:red !important;">{{ v.role_names }}</td>
					<td style="color:red !important;">{{ v.sex_name }}</td>
					<td style="color:red !important;">{{ v.usertype_name }}</td>
					<td style="color:red !important;">{{ v.create_time }}</td>
					<td style="color:red !important;">{{ v.login_time }}</td>
					{{# }else{ }}
					<td>{{ v.realname }}</td>
					<td>{{ v.zonename }}</td>
					<td>{{ v.role_names }}</td>
					<td>{{ v.sex_name }}</td>
					<td>{{ v.usertype_name }}</td>
					<td>{{ v.create_time }}</td>
					<td>{{ v.login_time }}</td>
					{{# } }}
					<td>
						<a href="javascript:;" class="proSelect"><i></i></a>
						<div class="otherOperation">
							<div class="triangle"></div>
							<div class="otherIcon">
								<ul>
									{{# if(v.isuserinfo==0){ }}
									<li>
										<a href="javascript:;" onclick="layer.msg('该员工还未添加档案内容',{icon:2});">
											<span class="fileDetail"></span>
											<em>档案详情</em>
										</a>
									</li>
									{{# }else{ }}
									<li>
										<a href="{:U('System/Personnel/systemUserInfo')}'?user_id={{ v.system_user_id }}">
											<span class="fileDetail"></span>
											<em>档案详情</em>
										</a>
									</li>
									<li>
										<a href="{:U('System/Personnel/editSystemUserInfo')}'?user_id={{ v.system_user_id }}">
											<span class="fileChange"></span>
											<em>修改档案</em>
										</a>
									</li>
									{{# } }}
									<li>
										<a href="javascript:;" class="Offline" data-id="{{ v.system_user_id }}">
											<span class="fileChange"></span>
											<em>强制离线</em>
										</a>
									</li>
									<li>
										<a href="javascript:;" class="usertypeBtn">
											<span class="turnoverSettings"></span>
											<em>离职设置</em>
										</a>
									</li>
									<li>
										<a href="{:U('System/Personnel/editSystemUser')}'?user_id={{ v.system_user_id }}">
											<span class="modify"></span>
											<em>修改账号</em>
										</a>
									</li>
									<li>
										<a href="javascript:;" class="delSystemUser">
											<span class="delete"></span>
											<em>删除账号</em>
										</a>
									</li>
								</ul>
							</div>
						</div>
					</td>
				</tr>
				{{#  }); }}
			</table>
		</script>
		<!--列表模版-->
		<script id="demo2" type="text/html">
			<dl class="select2">
				<dt>
					<div class="select_title l">全部职位</div>
					<div class="arrow r"></div>
				</dt>
				<dt class="caption">
				<div class="select_title2 l dt_btn" data-name="role_id" data-value="0">全部职位</div>
				</dt>
				{{# layui.each(d, function(k, v){ }}
					<dt class="caption">
					<div class="select_title2 l " data-name="role_id" data-value="{{ v.department_id }}">{{ v.departmentname }}</div>
					</dt>
					{{# layui.each(v.children, function(k2, v2){ }}
						<dd class="fxDone" data-name="role_id" data-value="{{ v2.id }}">{{ v2.name }}</dd>
					{{# }); }}
				{{# }); }}
			</dl>
			<input type="hidden" name="role_id" value="{{# $.getUrlParam('role_id'); }}">
		</script>
		<!--列表模版-->
		<script id="demo3" type="text/html">
			<dl class="select">
				<dt>
					<div class="select_title l">全部员工状态</div>
					<div class="arrow r"></div>
				</dt>
				<dd class="fxDone" data-value="0" data-name="usertype">全部员工状态</dd>
				{{# layui.each(d, function(k, v){ }}
					{{# if(k!=10){ }}
					<dd class="fxDone" data-value="{{ k }}" data-name="usertype">{{ v }}</dd>
					{{# } }}
				{{# }); }}
			</dl>
			<input type="hidden" name="usertype" value="{{# $.getUrlParam('usertype'); }}">
		</script>
		<link rel="stylesheet" href="__PUBLIC__/js/pjax/css/nprogress.css">
		<script type="text/javascript" src="__PUBLIC__/js/pjax/js/jquery.pjax.js"></script>
		<script type="text/javascript" src="__PUBLIC__/js/pjax/js/nprogress.js"></script>
		<script src="__PUBLIC__/js/layui/layui.js"></script>
		<script src="__PUBLIC__/js/layer/layer.js"></script>
		<script src="__PUBLIC__/js/common.js"></script>
		<script src="__PUBLIC__/js/personnel.systemuserlist.js"></script>
		<script>
			//获取页面参数
			var thisObj = $('#pjax_body');
			var page = $.getUrlParam('page',1);
			thisObj.html(getLoding());
			getAjax(page);
			//获取列表内容
			function getAjax(page){
				var order = $.getUrlParam('order');
				var data = {
					zone_id: $.getUrlParam('zone_id'),
					role_ids: $.getUrlParam('role_id'),
					realname:"",
					usertype: $.getUrlParam('usertype',"neq,10"),
					page: ((page-1)*20)+',20'
				};
				common_ajax2(data,'/SystemApi/SystemUser/getSystemUserList','no',function(redata){
					if(redata.data.data){
						layui.use('laytpl', function(){
							var laytpl = layui.laytpl;
							laytpl(demo.innerHTML).render(redata.data.data, function(result){
								thisObj.html(result);
							});
						});
					}else{
						thisObj.html(getNullHint());
					};
					//分页
					if(redata.data.count>0){
						layui.use(['laypage', 'layer'], function(){
							var laypage = layui.laypage,layer = layui.layer;
							laypage({
								cont:  $('.paging')
								,pages:  Math.ceil(redata.data.count/20) //总页数
								,groups: 5 //连续显示分页数
								,first:'首页'
								,last:'尾页'
								,skin: '#4dbe88'
								,curr: page
								,jump: function(obj, first){
									//得到了当前页，用于向服务端请求对应数据
									var curr = obj.curr;
									if(!first){
										location.href=$.getUrl('page',curr);
									}
								}
							});
						});
					};
				},1);
			};
			//获取部门职位列表
			common_ajax2('','/SystemApi/Department/getDepartmentRoleList','no',function(redata){
				if(redata.data.data){
					layui.use('laytpl', function(){
						var laytpl = layui.laytpl;
						laytpl(demo2.innerHTML).render(redata.data.data, function(result){
							$('#role_li').html(result);
						});
					});
				};
			},1);
			//获取员工状态列表
			common_ajax2({name:'SYSTEMUSERSTATUS'},'/SystemApi/Config/getStatusList','no',function(redata){
				if(redata.data){
					layui.use('laytpl', function(){
						var laytpl = layui.laytpl;
						laytpl(demo3.innerHTML).render(redata.data, function(result){
							$('#usertype_li').html(result);
						});
					});
				};
			},1);
		</script>
	</body>
</html>
