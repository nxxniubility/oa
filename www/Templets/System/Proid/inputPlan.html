<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
		<title>系统首页-{$siteinfo.sitename}</title>
		<link rel="stylesheet" href="__PUBLIC__/css/common.css">
		<link rel="stylesheet" href="__PUBLIC__/css/import.css">	
	</head>
	<body>
		<div class="wrapBox" id="inpPlanWrap">
			<div class="proCont">
				<div class="proContTop clearfix">
					<div class="topTit l">
						<span class="masterList">推广账号管理</span>
						<span><em>&gt;</em>导入推广计划</span>
					</div>
					<div class="topRight r">
						<a href="<?php echo U('System/Proid/setPages', array('proid_id'=>$proidInfo['proid_id']));?>" class="settingPlan">设置计划模版</a>
						<a href="<?php echo U('System/Proid/index', array('proid_id'=>$proidInfo['proid_id']));?>" class="return">返回</a>
						<!--<a href="dpsProgramList.html" class="return">返回</a>-->
					</div>
				</div>
				<form method="post" action="" enctype="multipart/form-data" onsubmit="return check(this)">
					<div class="improContMiddle">
						<div class="proRow clearfix">
							<div class="imLeft l"><i>&#42</i>推广账号:</div>
							<div class="imRight l">
								{$proidInfo['accountname']}
							</div>
						</div>
						<div class="proRow clearfix">
							<div class="imLeft l">选择模板:</div>
							<div class="imRight l">
								<select class="imSelect" name="setpages_id">
									<option selected="selected" value="">请选择模板</option>
									<foreach name = "setPages" item = "page">
										<option value="{$page['setpages_id']}">{$page['pagesname']}</option>
									</foreach>
								</select>
								
							</div>
						</div>
						<div class="proRow clearfix"  style="height:60px;">
							<div class="imLeft l"><i>&#42</i>上传Excel文件:</div>
							<div class="imRight l">
								<div class="imUploadBox"  id="imUploadBox">
									<span>上传文件</span>
									<input type="file" name="file"  class="imUploadBtn" unselectable="on"   onChange="var path=$(this).val();$('#uploadfile').val(path);$('#imUploadBox  p').html('已选文件：'+get_file_name(path));">
                                   <input type="hidden" name="uploadfile"  id="uploadfile">
                                    <br/>
                                    <p   style="color:#f00;">注意：每个Excel文件第一行必须设置表头字段，否则数据导入将会遗漏。</p>
								</div>
							</div>
						</div>
						<div class="proRow clearfix">
							<div class="imLeft l">PC端专题页:</div>
							<div class="imRight l">
								<div class="pcUploadBox">
									<input type="button" class="pcUploadBtn" id="pcUploadBtn" value="选择专题页">&nbsp;&nbsp;<span></span>
								</div>
								<input type="hidden" name="pcPagesType_id" autocomplete="off"  value="{$pro['pcPagesType_id']}"  >
							</div>
						</div>
						<div class="proRow clearfix">
							<div class="imLeft l">移动端专题页:</div>
							<div class="imRight l">
								<div class="mobileUploadBox">
									<input type="button" class="mbUploadBtn" id="mUploadBtn" value="选择专题页">&nbsp;&nbsp;<span></span>
								</div>
								<input type="hidden" name="mPagesType_id" autocomplete="off"  value="{$pro['mPagesType_id']}">
							</div>
						</div>
						<div class="proRow clearfix">
							<div class="imLeft l">&nbsp;</div>
							<div class="imRight l">
								<input type="submit" class="imSubmit" value="提交">
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		
		<!-- 选择模版 S -->
		<div class="chooseTemplate" id="pcChooseTemplate">
			<div class="temTop clearfix">
				<span>PC端模版</span>
				<div class="imClose"></div>
			</div>
			<div class="temCont">
				<div class="temSearch clearfix">
					<span>筛选分类：</span>
					<select name="pcType_id">
						<option value="0" selected="selected">请选择分类：</option>
						<foreach name = "pro['pcPagesTypeList']" item = "pcPagesType">
							<option value="{$pcPagesType['pagestype_id']}">{$pcPagesType['typename']}</option>
						</foreach>
					</select>
					<input type="button" class="temSearchBtn" id="pcTemSearchBtn" value="搜索">
				</div>
				<div class="temMiddle">
					<div class="titBox clearfix">
						<span class="optionsSp">选中</span>
						<span class="picSp">缩略图</span>
						<span class="desSp">详细</span>
					</div>
					<div class="contBox" id="pcContBox">
						<div class="temRows clearfix">
							<label for="chosse1">
								<input type="radio" id="chosse1" name="pcPageid" value="">
							</label>
						</div>
					</div>
				</div>
				<a href="javascript:;" class="imChooseBtn PCpage" id="submit">确定</a>
			</div>
		</div>
		<!-- 选择模版 E -->
		<div class="chooseTemplate" id="mChooseTemplate">
			<div class="temTop clearfix">
				<span>移动端模版</span>
				<div class="imClose"></div>
			</div>
			<div class="temCont">
				<div class="temSearch clearfix">
					<span>筛选分类：</span>
					<select name="mType_id">
						<option value="0" selected="selected">请选择分类：</option>
						<foreach name = "pro['mPagesTypeList']" item = "mPagesType">
							<option value="{$mPagesType['pagestype_id']}">{$mPagesType['typename']}</option>
						</foreach>
					</select>
					<input type="button" class="temSearchBtn2" id="mTemSearchBtn" value="搜索">
				</div>
				<div class="temMiddle">
					<div class="titBox clearfix">
						<span class="optionsSp">选中</span>
						<span class="picSp">缩略图</span>
						<span class="desSp">详细</span>
					</div>
					<div class="contBox" id="mContBox">
						<div class="temRows clearfix">
							<label for="chosse1">
								<input type="radio" id="chosse1" name="mPageid" value="">
							</label>
						</div>

					</div>
				</div>
				<a href="javascript:;" class="imChooseBtn mpage" id="submit">确定</a>
			</div>
		</div>
		
		<script src="__PUBLIC__/js/jquery-1.9.1.min.js"></script>
		<script src="__PUBLIC__/js/jquery.mousewheel.js"></script>
		<script src="__PUBLIC__/js/layer/layer.js"></script>
		<script src="__PUBLIC__/js/import.js"></script>
		<script type="text/javascript">
			$(function(){
				$('#pcTemSearchBtn').click(function(){
					layer.load(2);
					$('#pcContBox').html('');
				    $.ajax({
				        url:"<?php echo U('System/Proid/pagesList'); ?>",
				        dataType:'json',
				        type:'post',
				        data:{pagesType_id:$(':input[name="pcType_id"]').val(),terminal_id:2},
				        success:function(reflag){
				            layer.closeAll('loading');
				            if(reflag.code==0){
				            	var str = '';
				                $.each(reflag.data.data,function(k,v){
				               		str+="<div class='temRows clearfix'><label for='chosse1'><input type='radio' id='chosse1' name='pcPageid' value='"+v.pages_id+"'></label><div class='picImgBox'><div class='limit'><img src='"+v.litpic+"' alt='缩略图'></div></div><div class='desBox clearfix'><p class='theme'>"+v.subject+"</p><p class='time'>备注："+v.remark+"</p><p class='time'>创建时间："+getDate(v.createtime)+"</p><p class='pang conversionRate'>信息转化率：100%</p><p class='pang forecastingRates'>预报率：0%</p><p class='pang views'>访问：0</p></div></div>";
				                });
				               	$('#pcContBox').html(str);
				            }else{
				                layer.msg(reflag.msg,{icon:2});
				            }
				        },
				        error:function(){
				            layer.msg('网络异常,请稍后再试！',{icon:2});
				            layer.closeAll('loading');
				        }
				    });
				});

				$('#mTemSearchBtn').click(function(){
					layer.load(2);
					$('#mContBox').html('');
				    $.ajax({
				        url:"<?php echo U('System/Proid/pagesList'); ?>",
				        dataType:'json',
				        type:'post',
				        data:{pagesType_id:$(':input[name="mType_id"]').val(),terminal_id:1},
				        success:function(reflag){
				            layer.closeAll('loading');
				            if(reflag.code==0){
				            	var str = '';
				               $.each(reflag.data.data,function(k,v){
				               		str+="<div class='temRows clearfix'><label for='chosse1'><input type='radio' id='chosse1' name='mPageid' value='"+v.pages_id+"'></label><div class='picImgBox'><div class='limit'><img src='"+v.litpic+"' alt='缩略图'></div></div><div class='desBox clearfix'><p class='theme'>"+v.subject+"</p><p class='time'>备注："+v.remark+"</p><p class='time'>创建时间："+getDate(v.createtime)+"</p><p class='pang conversionRate'>信息转化率：0%</p><p class='pang forecastingRates'>预报率：0%</p><p class='pang views'>访问：0</p></div></div>";
				               });
				               	$('#mContBox').html(str);
				            }else{
				                layer.msg(reflag.msg,{icon:2});
				            }
				        },
				        error:function(){
				            layer.msg('网络异常,请稍后再试！',{icon:2});
				            layer.closeAll('loading');
				        }
				    });
				});
		       
			});

			function getDate(tm){
				var tt=new Date(parseInt(tm) * 1000).toLocaleString().replace(/\//g, "-").replace(/下午/g, " ").replace(/上午/g, " ");
				return tt;
			}    

		 	function check(f){
		        if( f.setpages_id.value == '' ){
				    layer.msg('请选择模板,没有请添加',{icon:2});
		            return false;
		        }
				if( f.uploadfile.value == '' ){
				    layer.msg('请选择Excel文件！',{icon:2});
		            return false;
		        }
		        if( f.pcPagesType_id.value == '' || f.mPagesType_id.value == ''){
				    layer.msg('请选择专题页',{icon:2});
		            return false;
		        }
				layer.msg('正在导入，请稍候...',{icon:0,time:0});
		    }
			function get_file_name(str)
			{
				var arr=str.split('\\');
				return arr[arr.length-1];
			   	
			}
		</script>
		<script src="__PUBLIC__/js/common_ajax.js"></script>
	</body>
</html>
