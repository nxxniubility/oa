<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>系统首页-{$siteinfo.sitename}</title>
    <link rel="stylesheet" href="__PUBLIC__/css/common.css">
    <link rel="stylesheet" href="__PUBLIC__/css/jquery.treetable.css">
    <link rel="stylesheet" href="__PUBLIC__/css/jquery.treetable.theme.default.css">
    <link rel="stylesheet" href="__PUBLIC__/css/addPermissions.css">
</head>

<body>
<div class="wrapBox">
    <div class="addPerCont">
        <div class="addPerContTop clearfix">
            <div class="topTit l">
                <span class="masterList">职位权限管理</span>
                <span><em>&gt;</em>修改职位权限</span>
            </div>
            <div class="topRight r">
                <a href="{:U('System/Personnel/position')}" class="return">返回</a>
            </div>
        </div>
        <div class="addPerMiddle">
            <div class="addPerRow clearfix">
                <div class="addPerLeft"><i>&#42</i>职位名称:</div>
                <div class="addPerRight">
                    <input type="text" class="addPerInp" name="positionname" value="{$data['roleInfo']['name']}">
                </div>
            </div>
            <div class="addPerRow clearfix">
                <div class="addPerLeft"><i>&#42</i>职位描述:</div>
                <div class="addPerRight">
                    <input type="text" class="addPerInp" name="remark" value="{$data['roleInfo']['remark']}"  onkeyup="chkLength(this,30)">
                </div>
            </div>
            <div class="addPerRow clearfix">
                <div class="addPerLeft"><i>&#42</i>所属部门:</div>
                <div class="addPerRight">
                    <div class="selectbox l">
                        <dl class="select">
                            <dt>
                                <if condition="$data['roleInfo']['department_id'] neq 0">
                                    <foreach  name="data['departmentAll']['data']" item="v" key="k">
                                        <if condition="$v['department_id'] eq $data['roleInfo']['department_id']">
                                            <div class="select_title l">{$v.departmentname}</div>
                                        </if>
                                    </foreach>
                                <else/>
                                    <div class="select_title l" >请选择部门</div>
                                </if>
                            <div class="arrow r" ></div>
                            </dt>
                            <!-- 代码-->
                            <foreach  name="data['departmentAll']['data']" item="v" key="k">
                                <dd class="fxDone" data-value="{$v.department_id}">{$v.departmentname}</dd>
                            </foreach>
                        </dl>
                        <input type="hidden" name="department_id" value="{$data['roleInfo']['department_id']}">
                    </div>
                </div>
            </div>
            <div class="addPerRow clearfix">
                <div class="addPerLeft"><i>&#42</i>直属上级:</div>
                <div class="addPerRight">
                    <div class="selectbox l">
                        <dl class="select">
                            <dt>
                            <if condition="$data['roleInfo']['superiorid'] neq 0">
                                <foreach  name="data['roleAll']['data']" item="v" key="k">
                                    <if condition="$v['id'] eq $data['roleInfo']['superiorid']">
                                        <div class="select_title l">{$v.name}</div>
                                        <?php break; ?>
                                    </if>
                                </foreach>
                            <else/>
                                <div class="select_title l">顶级</div>
                            </if>
                            <div class="arrow r" ></div>
                            </dt>
                            <!-- 代码-->
                            <dd class="fxDone" data-value="0">顶级{$data['roleInfo']['superiorid']}</dd>
                            <foreach  name="data['roleAll']['data']" item="v" key="k">
                                <if condition="$v['id'] neq $data['roleInfo']['id']">
                                    <dd class="fxDone" data-value="{$v.id}">{$v.name}</dd>
                                </if>
                            </foreach>
                        </dl>
                        <input type="hidden" name="superiorid" value="{$data['roleInfo']['superiorid']}">
                    </div>
                </div>
            </div>
            <div class="addPerRow clearfix">
                <div class="addPerLeft"><i>&#42</i>权限设置:</div>
                <div class="addPerRight">
                    <span class="selectPermissions">选择权限</span>
                </div>
            </div>
            <div class="addPerRow clearfix">
                <div class="addPerLeft"><i>&#42</i>状态:</div>
                <div class="addPerRight">
                    <label for="radio1">
                        <input type="radio" name="display" class="addPerRadio" id="radio1" value="1" <?php echo $data['roleInfo']['display']==1?'checked="checked"':''; ?> >
                        <span>启用</span>
                    </label>
                    <label for="radio2">
                        <input type="radio" name="display" class="addPerRadio" id="radio2" value="0" <?php echo $data['roleInfo']['display']==0?'checked="checked"':''; ?>>
                        <span>禁用</span>
                    </label>
                </div>
            </div>
            <div class="addPerRow clearfix">
                <div class="addPerLeft"><i>&#42</i>排序:</div>
                <div class="addPerRight">
                    <input type="tel" class="addPerInp w118" name="sort" value="{$data['roleInfo']['sort']}">
                </div>
            </div>
            <div class="addPerRow clearfix">
                <div class="addPerLeft">&nbsp;</div>
                <div class="addPerRight">
                    <input type="submit" class="addPerSubmit" value="提交">
                </div>
            </div>
        </div>
    </div>
</div>
<div class="competenceBox">
    <div class="addPerTop clearfix">
        <span>选择权限</span>
        <div class="addPerClose"></div>
    </div>
    <div class="boxMiddle">
        <div class="boxRows">
            <table id="boxTabel" width="100%" border="0" cellpadding="4" cellspacing="1" class="table treeTable">
                <tbody>
                {$data['nodeHtml']}
                </tbody>
            </table>
        </div>
    </div>
    <input type="button" class="addSubmit" value="确定">
</div>
<script src="__PUBLIC__/js/jquery-1.7.2.js"></script>
<script src="__PUBLIC__/js/layer/layer.js"></script>
<script src="__PUBLIC__/js/jquery.treetable.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        //树配置
        $("#boxTabel").treeTable({
            expandable: true,
        });
        //获取已有权限
        var on_nodes='{$data[\'roleAccess\']}';
        on_nodes = on_nodes.split(',');
        if(on_nodes.length>0){
            for(var i=0;i<on_nodes.length;i++){
                $('#node-'+on_nodes[i]).children().children('.radio').attr('checked',true);
            }
        }
        //提交
        $('.addPerSubmit').click(function() {
            //获取node_id
            var access='';
            if($('.radio:checked').length>0){
                for(var i=0;i<$('.radio:checked').length;i++){
                    var Obj = null;
                    Obj = $('.radio:checked').eq(i);
                    if(i==0){
                        access+=Obj.val()+'-'+Obj.attr('pid')+'-'+Obj.attr('level');
                    }else{
                        access+=','+Obj.val()+'-'+Obj.attr('pid')+'-'+Obj.attr('level');
                    }
                }
            }
            var data = {
                positionname:$(':input[name="positionname"]').val(),
                remark:$(':input[name="remark"]').val(),
                department_id:$(':input[name="department_id"]').val(),
                superiorid:$(':input[name="superiorid"]').val(),
                sort:$(':input[name="sort"]').val(),
                display:$(':input[name="display"]:checked').val(),
                access:access
            };
            common_ajax(data);
        });
    });
</script>
<script src="__PUBLIC__/js/addPermissions.js"></script>
<script src="__PUBLIC__/js/common.js"></script>
</body>

</html>
